<div class="d-flex justify-content-end pt-3">
  <div class="clock">YYYY/MM/DD HH:MI:SS</div>
</div>
<div class="row pt-3">
  <div class="col-7 pb-3 box">
    <div class="row flex_column_direction">
      {{!-- <h3>X X O O</h3> --}}
      <div id="forecast-weather"></div>
      {{!-- <div>fst</div>
      <div>snd</div> --}}
    </div>
    <div class="row pt-3">
      <div class="col">
        <div class="border border-secondary rounded-top">
          <h5 class="rounded-top">即時路況</h5>
          {{!-- <h5>X X O O</h5> --}}
        </div>
        <div id="map" style="height: 243px; width: 320px;"></div>
        {{!-- <iframe
          src="https://www.google.com/maps/embed?pb=!1m14!1m12!1m3!1d14880.059565918398!2d121.36944460005144!3d25.06414825625926!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!5e0!3m2!1szh-TW!2stw!4v1591834497114!5m2!1szh-TW!2stw"
          width="400" height="300" frameborder="0" allowfullscreen="" aria-hidden="false" tabindex="0"></iframe> --}}
      </div>
      <div class="col">
        <div class="border border-secondary rounded-top">
          <h5 class="rounded-top">文化一路一段/麗園一街口</h5>
          {{!-- <h5>X X O O</h5> --}}
        </div>
        <iframe src="http://117.56.58.1/LiveVideo.html?deviceid=48&account=dmlld2Vy&password=dmlld2Vy"
          frameborder="0"></iframe>
      </div>
    </div>
    <div class="row pt-3">
      <div class="col">
        <div class="border border-secondary rounded-top">
          <h5 class="rounded-top">文化一路一段/忠孝路口</h5>
          {{!-- <h5>X X O O</h5> --}}
        </div>
        <iframe src="http://117.56.58.2/LiveVideo.html?deviceid=2&account=dmlld2Vy&password=dmlld2Vy"
          frameborder="0"></iframe>
      </div>
      <div class="col">
        <div class="border border-secondary rounded-top">
          <h5 class="rounded-top">文化一路一段/國道1號南下入口</h5>
          {{!-- <h5>X X O O</h5> --}}
        </div>
        <iframe src="http://117.56.232.7/LiveVideo.html?deviceid=29&account=dmlld2Vy&password=dmlld2Vy"
          frameborder="0"></iframe>
      </div>
    </div>
  </div>
  <div class="col-5 box">
    <div class="row flex_column_direction">
      <div class="realTime-weather-section">
        {{!-- <h3>OXOX</h3> --}}
        <div id="realTime-weather"></div>
        {{!-- <div>fst</div>
        <div>snd</div> --}}
      </div>
    </div>
    <div class="row pt-3">
      <div class="col">
        <div id="traffic_board">

          {{!-- <div class="card mb-2">
            <div class="card-header">
              <img class="rounded-circle " style="max-width: 30px;"
                src="https://lh3.googleusercontent.com/a-/AOh14GgV5uPp3SX0JwKNfrE1b9LBNEXPjwMHxaV-Da3G5A=s96-c" alt=""
                srcset="">
              <span class="card_header_padding">Kev</span>
            </div>
            <div class="card-body">
              <div class="card-title flex_card_title">
                <span class="category_tag category_attention">注意</span>
                <h6 class="card_title_padding">[07:31]</h6>
                <h6 class="card_title_padding">文化一路一段, 北上交流道口測試測試測試測試測試測試測試測試測試</h6>
              </div>
              <p class="card-text">並行停車，雍塞</p>
            </div>
          </div> --}}

          <div class="card text-center mb-2">
            <div class="card-body">
              <p class="card-text">等待回報交通資訊</p>
            </div>
          </div>
        </div>
        <div class="my-3 d-flex justify-content-between">
          <button type="button" class="btn btn-primary ms-2" id="previous_page_btn" page="">Previous</button>
          <button type="button" class="btn btn-primary ms-2" id="next_page_btn" page="">Next</button>
        </div>
      </div>
    </div>
  </div>
</div>

<script src="/js/clock.js"></script>
<script src="/js/cwbForecastWeatherAPI.js"></script>
<script src="/js/cwbRealTimeWeatherAPI.js"></script>
<script src="/js/googleMap.js"></script>
<script async defer
  src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBaI5BVp9PApBENibhWc1jXrVmrZUKJtDk&callback=initMap">
  </script>

<script>

  let previousPageBtn = document.getElementById("previous_page_btn");
  let nextPageBtn = document.getElementById("next_page_btn");
  let trafficBoard = document.getElementById("traffic_board");

  const body = document.addEventListener("DOMContentLoaded", init);
  function init() {
    // const APIKey = "CWB-3368DCAB-74F5-4D48-82F3-DA9B5699CE79";
    const distsTarget = ["林口", "龜山"];
    let w = new RealTimeWeather(
      document.querySelector("#realTime-weather"),
      distsTarget,
      APIKey
    );
    startTime();
    board(1);
  }


  function board(page) {
    $.ajax({
      type: "GET",
      url: "/linkou/test",
      data: { page: page },
      dataType: "json",
      contentType: "application/json; charset=utf-8",
      error: function (e) {
        console.log("error:", e);
      },
      success: function (result) {
        console.log("data:", result);
        trafficBoard.innerHTML = "";
        previousPageBtn.setAttribute("page", "");
        nextPageBtn.setAttribute("page", "");

        if (undefined === result.previous) {
          previousPageBtn.classList.add("disabled");
        }
        if (undefined === result.next) {
          nextPageBtn.classList.add("disabled");
        }

        if (undefined !== result.previous) {
          previousPageBtn.classList.remove("disabled");
          previousPageBtn.setAttribute("page", result.previous.page);
          previousPageBtn.addEventListener("click", function () {
            board(previousPageBtn.getAttribute("page"));
          })
        }
        if (undefined !== result.next) {
          nextPageBtn.classList.remove("disabled");
          nextPageBtn.setAttribute("page", result.next.page);
          nextPageBtn.addEventListener("click", function () {
            console.log(nextPageBtn.page);
            board(nextPageBtn.getAttribute("page"));
          })
        }

        if (0 !== result.results.length) {
          let fragment = document.createDocumentFragment();

          for (x of result.results) {
            let card = document.createElement("div");
            card.classList.add("card", "mb-2");
            let cardHeader = document.createElement("div");
            let userImage = document.createElement("img");
            let userName = document.createElement("span");

            cardHeader.classList.toggle("card-header");

            userImage.classList.toggle("rounded-circle");
            userImage.style.maxWidth = "30px";
            userImage.src = x.user.image.toString();

            userName.classList.toggle("card_header_padding");
            userName.textContent = x.user.displayName;

            cardHeader.appendChild(userImage);
            cardHeader.appendChild(userName);

            let cardBody = document.createElement("div");
            cardBody.classList.toggle("card-body");
            let cardTitle = document.createElement("div");
            cardTitle.classList.add("card-title", "flex_card_title");
            let categoryTag = document.createElement("span");
            categoryTag.classList.add("category_tag", "category_attention");
            categoryTag.textContent = x.accidentCategory.accidentText;
            let timeTag = document.createElement("h6");
            timeTag.classList.toggle("card_title_padding");
            let localTime = new Date(x.createdAt);
            timeTag.textContent = `[${localTime.getHours()}:${localTime.getMinutes()}]`;
            let roadInformationTag = document.createElement("h6");
            roadInformationTag.classList.toggle("card_title_padding");
            roadInformationTag.textContent = x.location;
            cardTitle.appendChild(categoryTag);
            cardTitle.appendChild(timeTag);
            cardTitle.appendChild(roadInformationTag);
            cardBody.appendChild(cardTitle);

            let cardTextContent = document.createElement("p");
            cardTextContent.classList.toggle("card-text");
            cardTextContent.innerHTML = x.body;

            cardBody.appendChild(cardTextContent);
            card.appendChild(cardHeader);
            card.appendChild(cardBody);
            fragment.appendChild(card);
          }
          trafficBoard.appendChild(fragment);
        }
      },
    });
  }

</script>